<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Offer Grid Builder</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      max-width: 1200px;
      margin: 2rem auto;
      padding: 0 1rem;
    }
    h1 { font-size: 1.6rem; margin-bottom: 0.25rem; }
    .hint { color:#666; font-size:0.9rem; margin-bottom: 1rem; }

    .card {
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 1rem;
      margin: 1rem 0;
      background: #fafafa;
    }

    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      align-items: end;
    }
    .field {
      display:flex;
      flex-direction:column;
      min-width: 220px;
    }
    label { font-weight: 650; margin-bottom: 0.25rem; }
    select, input {
      padding: 0.4rem 0.55rem;
      border: 1px solid #bbb;
      border-radius: 8px;
      background: white;
    }

    /* Two phases on same line */
    .phases-row {
      display: flex;
      gap: 1rem;
      align-items: stretch;
    }
    .phase-panel {
      flex: 1 1 0;
      min-width: 0; /* critical: allows inner scroll instead of page overflow */
      border: 1px solid #ddd;
      background: #fff;
      border-radius: 10px;
      overflow: hidden;
    }
    .phase-header {
      padding: 0.75rem 0.9rem;
      background: #f2f2f2;
      border-bottom: 1px solid #e2e2e2;
      font-weight: 800;
    }
    .phase-body {
      padding: 0.75rem 0.9rem;
    }

    /* Table styling */
    .table-wrap {
      overflow-x: auto;          /* horizontal scroll stays inside each phase */
      -webkit-overflow-scrolling: touch;
      border: 1px solid #eee;
      border-radius: 10px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      min-width: 640px; /* Phase 1 baseline */
    }
    table.phase2 {
      min-width: 1300px; /* Phase 2 needs more width; scroll inside panel */
    }
    th, td {
      border-bottom: 1px solid #eee;
      padding: 0.55rem 0.6rem;
      vertical-align: middle;
      white-space: nowrap;
    }
    th {
      background: #fafafa;
      text-align: left;
      font-weight: 700;
      border-bottom: 1px solid #e6e6e6;
    }

    .cell-input, .cell-select {
      width: 100%;
      min-width: 140px;
      box-sizing: border-box;
    }
    .cell-select { min-width: 160px; }

    .readonly {
      padding: 0.4rem 0.55rem;
      border: 1px solid #bbb;
      border-radius: 8px;
      background: #fff;
      min-width: 120px;
      box-sizing: border-box;
    }
    .readonly.blue {
      background: #d9f0f7;
      font-weight: 650;
    }

    .btns {
      display:flex;
      gap: 0.5rem;
      margin-top: 0.9rem;
      justify-content: flex-start;
    }
    button {
      padding: 0.5rem 0.8rem;
      border-radius: 10px;
      border: 1px solid #bbb;
      background: white;
      cursor: pointer;
      font-weight: 650;
    }
    button:hover { background:#f3f3f3; }

    .small { font-size: 0.85rem; color:#666; margin-top:0.6rem; }

    /* Responsive: stack phases on small screens */
    @media (max-width: 1020px) {
      .phases-row { flex-direction: column; }
    }
  </style>
</head>
<body>
  <h1>Offer Grid Builder</h1>
  <div class="hint">
    Excel-style horizontal rows. Phase 1 and Phase 2 sit side-by-side. “Add Row” adds a row to both phases.
  </div>

  <!-- TOP CONTROLS -->
  <div class="card">
    <div class="row">
      <div class="field">
        <label for="regionCode">Region</label>
        <select id="regionCode">
          <option value="">-- Select Region --</option>
          <option value="ALR">ALR</option>
          <option value="CEN">CEN</option>
          <option value="EAS">EAS</option>
          <option value="MAT">MAT</option>
          <option value="MTN">MTN</option>
          <option value="SCR">SCR</option>
          <option value="SOU">SOU</option>
          <option value="WES">WES</option>
        </select>
        <div class="small">Updates all HDAA_Description dropdowns.</div>
      </div>

      <div class="field">
        <label for="offerStart">Offer Start Date</label>
        <input id="offerStart" type="date" />
      </div>

      <div class="field">
        <label for="offerEnd">Offer End Date</label>
        <input id="offerEnd" type="date" />
      </div>
    </div>
  </div>

  <!-- PHASES SIDE BY SIDE -->
  <div class="card">
    <div class="phases-row">
      <!-- Phase 1 -->
      <div class="phase-panel">
        <div class="phase-header">Phase 1: Offer Grid Rows</div>
        <div class="phase-body">
          <div class="table-wrap">
            <table id="phase1Table">
              <thead>
                <tr>
                  <th style="width:70px;">Row</th>
                  <th>HDAA_Description</th>
                  <th>Model_Year</th>
                  <th>Model_Name</th>
                  <th>Trim_Name</th>
                  <th>Model_ID</th>
                  <th style="width:110px;">Action</th>
                </tr>
              </thead>
              <tbody id="phase1Body"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Phase 2 -->
      <div class="phase-panel">
        <div class="phase-header">Phase 2: Cash Total Savings Offer Section</div>
        <div class="phase-body">
          <div class="table-wrap">
            <table class="phase2" id="phase2Table">
              <thead>
                <tr>
                  <th style="width:70px;">Row</th>
                  <th>Creative_Name</th>
                  <th>Cash_Wrapper_Creative</th>
                  <th>Cash_Disclaimer_Type</th>
                  <th>Cash_Incentive_Number</th>

                  <th>Cash_Incentive_Type</th>
                  <th>Cash_Offer_DisplayName</th>
                  <th>Cash_Offer_Prefix</th>

                  <th>Cash_Offer_Price</th>
                  <th>Cash_Offer_Suffix</th>

                  <th>Cash_Offer_ShortDescription</th>

                  <th>Cash_RetailBonusCashOfferDetails</th>
                  <th>Cash_HmfStandardAprOfferDetails</th>
                  <th>Cash_Disclaimer</th>

                  <th>Cash_PurchaseStartDate</th>
                  <th>Cash_PurchaseEndDate</th>
                </tr>
              </thead>
              <tbody id="phase2Body"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <div class="btns">
      <button id="addRowBtn" type="button">Add Row</button>
      <button id="clearRowsBtn" type="button">Clear Rows</button>
    </div>

    <div class="small">
      Model_ID is looked up by Model_Name. Phase 2 auto fields populate when Cash_Wrapper_Creative is selected, and dates come from Offer Start/End Date.
    </div>
  </div>

  <script>
    // -------------------------
    // LOOKUPS
    // -------------------------
    const MARKETS_BY_REGION = {
      ALR: ["All Markets","ALR"],
      CEN: ["All CEN","Chicago","CHI","Cincinnati","CIN","Cleveland","CLE","Columbus","COL","Detroit","DET","Indianapolis","IND","Milwaukee","MIL","St. Louis","STL"],
      EAS: ["All EAS","Albany-Schenectady","ALB","Bangor","PTB","Boston","BOS","Buffalo","BUF","Hartford","HAR","New York","NYC","Philadelphia","PHI","Portland-Polano","PTA","Providence-New Bedford","PRV","Rochester","ROH","Springfield","SCH"],
      MAT: ["All MAT","Baltimore","BAL","Charlotte","CHA","Greensboro","GHW","Norfolk/Portsmouth/Newport News","NOR","Raleigh-Durham","RAL","Richmond","RCH","Washington D.C.","WDC","Harrisburg-York","HRB","Pittsburgh","PIT","Wilkes Barre-Scranto","WIL"],
      MTN: ["All MTN","Boise","BOI","Colorado Springs","CSP","Denver","DEN","El Paso/Indianapolis St.","ELP","Minneapolis","MIN","Portland","POR","Salt Lake City","SLC","Seattle","SEA"],
      SCR: ["All SCR","Albuquerque","ABQ","Austin","AUS","Dallas","DAL","El Paso","ELP","Ft. Smith/Fayetteville/Springdale/Rogers","FSM","Houston","HOU","Kansas City","KAN","Little Rock","LRA","McAllen","MCA","Oklahoma City","OKC","San Antonio","SAN","Tulsa","TUL"],
      SOU: ["All SOU","Atlanta","ATL","Birmingham","BIR","Boca","BOC","Ft. Myers/Naples","FTM","Greenville/Spartanburg/Asheville/Anderson","GNV","Jacksonville","JAC","Memphis","MEM","Miami","MIA","Mobile","MOB","Nashville","NAS","New Orleans","NOL","Orlando","ORL","Savannah","SAV","Tampa","TAM","West Palm Beach-Ft. Pierce","WPB"],
      WES: ["All WES","Honolulu","HON","Las Vegas","LVG","Los Angeles","LOS","Phoenix","PHO","Sacramento","SAC","San Diego","SDO","Tucson","TUC","San Francisco","SFO"]
    };

    const MODEL_ID_BY_NAME = {
      "Alt Fuel": "",
      "Accent": "1001",
      "Elantra": "4001",
      "Elantra GT": "D001",
      "Elantra Hybrid": "4006",
      "Elantra N": "4008",
      "Ioniq 5": "5004",
      "Ioniq 6": "A004",
      "Ioniq 9": "7004",
      "Ioniq Hybrid": "N006",
      "Ioniq Plug-In Hybrid": "N005",
      "Kona": "Q001",
      "Kona Electric": "Q004",
      "Kona N": "Q008",
      "Nexo": "K007",
      "Palisade": "J001",
      "Palisade Hybrid": "J006",
      "Santa Cruz": "9001",
      "Santa Fe": "6001",
      "Santa Fe Hybrid": "6006",
      "Santa Fe Plug-In Hybrid": "6005",
      "Sonata": "2001",
      "Sonata Hybrid": "2006",
      "Tucson": "8001",
      "Tucson Hybrid": "8006",
      "Tucson Plug-In Hybrid": "8005",
      "Veloster": "F001",
      "Veloster N": "F008",
      "Venue": "3001"
    };

    const TRIMS = [
      "All","Blue","Blue Hybrid","Blue Hybrid AWD","Calligraphy","Calligraphy AWD","Electric Limited","Electric SE","Electric SEL",
      "Hybrid Blue","Hybrid Limited","Hybrid SE","Hybrid SEL","Limited","Limited AWD","Limited Hybrid","Limited Hybrid AWD",
      "Limited Plug-in Hybrid AWD","N DCT","N Line","N Line AWD","N Line DCT","N Line FWD","N Line M/T","N Line Night Edition",
      "N M/T","Night","Plug-in Hybrid Limited","Plug-in Hybrid SE","Plug-in Hybrid SEL","SE","SE AWD","SE Standard Range","SEL",
      "SEL AWD","SEL Convenience Hybrid AWD","SEL Plug-in Hybrid AWD","SEL Plus","SEL Premium","XRT","XRT AWD","XRT FWD"
    ];

    const MODEL_YEARS = ["2025","2026","2027","2028","2029","2030"];

    const CREATIVE_NAME_OPTIONS = [
      { code: "",        label: "-- Select --" },
      { code: "25PROMO", label: "2025 Promo Period Creative" },
      { code: "SPGSE",   label: "Spring Getaway Sales Event" },
      { code: "SGSE",    label: "Summer Getaway Sales Event" },
      { code: "WGSE",    label: "Winter Getaway Sales Event" },
      { code: "WIN",     label: "Wins Every Time VS Campaign" },
      { code: "CUA",     label: "Customer Assurance" },
      { code: "BRD",     label: "Brand" },
      { code: "EVE",     label: "Evergreen" },
      { code: "EVECON",  label: "Evergreen Conquest" },
      { code: "EVERET",  label: "Evergreen Retention" }
    ];

    const CASH_WRAPPER_OPTIONS = [
      { label: "-- Select --" },
      { label: "Bonus Cash" },
      { label: "Dealer Cash" },
      { label: "Sales Event Cash" },
      { label: "Total Savings" },
      { label: "Total Savings + Charger + Installation" }
    ];

    // -------------------------
    // DOM
    // -------------------------
    const els = {
      regionCode: document.getElementById("regionCode"),
      offerStart: document.getElementById("offerStart"),
      offerEnd: document.getElementById("offerEnd"),
      phase1Body: document.getElementById("phase1Body"),
      phase2Body: document.getElementById("phase2Body"),
      addRowBtn: document.getElementById("addRowBtn"),
      clearRowsBtn: document.getElementById("clearRowsBtn")
    };

    // -------------------------
    // HELPERS
    // -------------------------
    function makeOption(value, text = null) {
      const opt = document.createElement("option");
      opt.value = value;
      opt.textContent = text ?? value;
      return opt;
    }

    function makeOptionWithCode(label, code, valueOverride = null) {
      const opt = document.createElement("option");
      opt.value = valueOverride !== null ? valueOverride : label;
      opt.textContent = label;
      opt.dataset.code = code || "";
      return opt;
    }

    function buildSelect(className, placeholderText) {
      const sel = document.createElement("select");
      sel.className = className + " cell-select";
      sel.appendChild(makeOption("", placeholderText));
      return sel;
    }

    function buildTextInput(className) {
      const input = document.createElement("input");
      input.type = "text";
      input.className = (className || "") + " cell-input";
      return input;
    }

    function readonlyBlueBox(dataCol) {
      const div = document.createElement("div");
      div.className = "readonly blue";
      div.textContent = "";
      div.setAttribute("data-col", dataCol);
      return div;
    }

    function readonlyBox(dataCol) {
      const div = document.createElement("div");
      div.className = "readonly";
      div.textContent = "";
      if (dataCol) div.setAttribute("data-col", dataCol);
      return div;
    }

    function formatDateShortMMDDYY(dateStr) {
      if (!dateStr) return "";
      const d = new Date(dateStr + "T00:00:00");
      if (isNaN(d.getTime())) return "";
      const mm = String(d.getMonth() + 1);
      const dd = String(d.getDate());
      const yy = String(d.getFullYear()).slice(-2);
      return `${mm}/${dd}/${yy}`;
    }

    function computeModelId(modelName) {
      if (!modelName) return "";
      return MODEL_ID_BY_NAME[modelName] ?? "";
    }

    function applyPhase2Autofields(wrapperValue, boxJ, boxK, boxL, boxO, boxS, boxT) {
      const hasWrapper = !!(wrapperValue && wrapperValue.trim());

      boxJ.textContent = hasWrapper ? wrapperValue : "";
      boxK.textContent = hasWrapper ? wrapperValue : "";
      boxL.textContent = hasWrapper ? "Up to" : "";
      boxO.textContent = hasWrapper ? wrapperValue : "";

      const start = els.offerStart.value || "";
      boxS.textContent = hasWrapper ? formatDateShortMMDDYY(start) : "";

      const end = els.offerEnd.value || "";
      boxT.textContent = hasWrapper ? formatDateShortMMDDYY(end) : "";
    }

    // Update all Phase 2 date-driven boxes when Offer dates change
    function refreshPhase2AutofieldsForAllRows() {
      const rows = els.phase2Body.querySelectorAll("tr[data-row-id]");
      rows.forEach(tr2 => {
        const wrapperSel = tr2.querySelector("select.hd-cash-wrapper");
        const boxJ = tr2.querySelector("[data-col='J']");
        const boxK = tr2.querySelector("[data-col='K']");
        const boxL = tr2.querySelector("[data-col='L']");
        const boxO = tr2.querySelector("[data-col='O']");
        const boxS = tr2.querySelector("[data-col='S']");
        const boxT = tr2.querySelector("[data-col='T']");
        if (!wrapperSel || !boxJ || !boxK || !boxL || !boxO || !boxS || !boxT) return;
        applyPhase2Autofields(wrapperSel.value, boxJ, boxK, boxL, boxO, boxS, boxT);
      });
    }

    // Update all market dropdowns when region changes
    function refreshAllMarketDropdowns() {
      const region = els.regionCode.value;
      const list = region && MARKETS_BY_REGION[region] ? MARKETS_BY_REGION[region] : [];

      els.phase1Body.querySelectorAll("select.hd-market").forEach(sel => {
        const current = sel.value;
        sel.innerHTML = "";
        sel.appendChild(makeOption("", "-- Select --"));
        list.forEach(v => sel.appendChild(makeOption(v)));

        // keep selection if still valid
        if (current && list.includes(current)) sel.value = current;
        else sel.value = "";
      });
    }

    function removeRow(rowId) {
      els.phase1Body.querySelector(`tr[data-row-id="${rowId}"]`)?.remove();
      els.phase2Body.querySelector(`tr[data-row-id="${rowId}"]`)?.remove();
    }

    // -------------------------
    // ROW CREATION
    // -------------------------
    let rowCounter = 1;

    function addRow() {
      const rowId = String(rowCounter);   // prevents mysterious skips
      rowCounter += 1;

      // -------------------------
      // PHASE 1 ROW
      // -------------------------
      const tr1 = document.createElement("tr");
      tr1.setAttribute("data-row-id", rowId);

      const tdRow1 = document.createElement("td");
      tdRow1.textContent = rowId;

      const tdMarket = document.createElement("td");
      const marketSel = buildSelect("hd-market", "-- Select --");
      const region = els.regionCode.value;
      const list = region && MARKETS_BY_REGION[region] ? MARKETS_BY_REGION[region] : [];
      list.forEach(v => marketSel.appendChild(makeOption(v)));
      tdMarket.appendChild(marketSel);

      const tdYear = document.createElement("td");
      const yearSel = buildSelect("hd-year", "-- Select --");
      MODEL_YEARS.forEach(y => yearSel.appendChild(makeOption(y)));
      tdYear.appendChild(yearSel);

      const tdModel = document.createElement("td");
      const modelSel = buildSelect("hd-model", "-- Select --");
      Object.keys(MODEL_ID_BY_NAME).forEach(name => modelSel.appendChild(makeOption(name)));
      tdModel.appendChild(modelSel);

      const tdTrim = document.createElement("td");
      const trimSel = buildSelect("hd-trim", "-- Select --");
      TRIMS.forEach(t => trimSel.appendChild(makeOption(t)));
      tdTrim.appendChild(trimSel);

      const tdModelId = document.createElement("td");
      const modelIdBox = readonlyBlueBox("E");
      tdModelId.appendChild(modelIdBox);

      modelSel.addEventListener("change", () => {
        modelIdBox.textContent = computeModelId(modelSel.value);
      });

      const tdAction = document.createElement("td");
      const rmBtn = document.createElement("button");
      rmBtn.type = "button";
      rmBtn.textContent = "Remove";
      rmBtn.addEventListener("click", () => removeRow(rowId));
      tdAction.appendChild(rmBtn);

      tr1.appendChild(tdRow1);
      tr1.appendChild(tdMarket);
      tr1.appendChild(tdYear);
      tr1.appendChild(tdModel);
      tr1.appendChild(tdTrim);
      tr1.appendChild(tdModelId);
      tr1.appendChild(tdAction);

      // -------------------------
      // PHASE 2 ROW
      // -------------------------
      const tr2 = document.createElement("tr");
      tr2.setAttribute("data-row-id", rowId);

      const tdRow2 = document.createElement("td");
      tdRow2.textContent = rowId;

      // Creative_Name
      const tdCreative = document.createElement("td");
      const creativeSel = document.createElement("select");
      creativeSel.className = "hd-creative-name cell-select";
      CREATIVE_NAME_OPTIONS.forEach((o, idx) => {
        const val = idx === 0 ? "" : o.label; // store label in value
        creativeSel.appendChild(makeOptionWithCode(o.label, o.code, val));
      });
      tdCreative.appendChild(creativeSel);

      creativeSel.addEventListener("change", () => {
        const code = creativeSel.selectedOptions?.[0]?.dataset?.code || "";
        tr2.dataset.creativeCode = code; // handy for later taxonomy building
      });
      tr2.dataset.creativeCode = creativeSel.selectedOptions?.[0]?.dataset?.code || "";

      // Cash_Wrapper_Creative
      const tdWrapper = document.createElement("td");
      const wrapperSel = document.createElement("select");
      wrapperSel.className = "hd-cash-wrapper cell-select";
      CASH_WRAPPER_OPTIONS.forEach((o, idx) => {
        const opt = document.createElement("option");
        opt.value = idx === 0 ? "" : o.label;
        opt.textContent = o.label;
        wrapperSel.appendChild(opt);
      });
      tdWrapper.appendChild(wrapperSel);

      // Inputs
      const tdDisclaimerType = document.createElement("td");
      tdDisclaimerType.appendChild(buildTextInput("hd-cash-disclaimer-type"));

      const tdIncentiveNumber = document.createElement("td");
      tdIncentiveNumber.appendChild(buildTextInput("hd-cash-incentive-number"));

      // Autos (blue)
      const tdJ = document.createElement("td"); const boxJ = readonlyBlueBox("J"); tdJ.appendChild(boxJ);
      const tdK = document.createElement("td"); const boxK = readonlyBlueBox("K"); tdK.appendChild(boxK);
      const tdL = document.createElement("td"); const boxL = readonlyBlueBox("L"); tdL.appendChild(boxL);

      // Inputs
      const tdOfferPrice = document.createElement("td");
      tdOfferPrice.appendChild(buildTextInput("hd-cash-offer-price"));

      const tdOfferSuffix = document.createElement("td");
      tdOfferSuffix.appendChild(buildTextInput("hd-cash-offer-suffix"));

      // Auto
      const tdO = document.createElement("td"); const boxO = readonlyBlueBox("O"); tdO.appendChild(boxO);

      // Inputs
      const tdRetailBC = document.createElement("td");
      tdRetailBC.appendChild(buildTextInput("hd-cash-retail-bc-details"));

      const tdHmfApr = document.createElement("td");
      tdHmfApr.appendChild(buildTextInput("hd-cash-hmf-apr-details"));

      const tdDisclaimer = document.createElement("td");
      tdDisclaimer.appendChild(buildTextInput("hd-cash-disclaimer"));

      // Autos dates
      const tdS = document.createElement("td"); const boxS = readonlyBlueBox("S"); tdS.appendChild(boxS);
      const tdT = document.createElement("td"); const boxT = readonlyBlueBox("T"); tdT.appendChild(boxT);

      wrapperSel.addEventListener("change", () => {
        applyPhase2Autofields(wrapperSel.value, boxJ, boxK, boxL, boxO, boxS, boxT);
      });

      tr2.appendChild(tdRow2);
      tr2.appendChild(tdCreative);
      tr2.appendChild(tdWrapper);
      tr2.appendChild(tdDisclaimerType);
      tr2.appendChild(tdIncentiveNumber);

      tr2.appendChild(tdJ);
      tr2.appendChild(tdK);
      tr2.appendChild(tdL);

      tr2.appendChild(tdOfferPrice);
      tr2.appendChild(tdOfferSuffix);

      tr2.appendChild(tdO);

      tr2.appendChild(tdRetailBC);
      tr2.appendChild(tdHmfApr);
      tr2.appendChild(tdDisclaimer);

      tr2.appendChild(tdS);
      tr2.appendChild(tdT);

      // Add to DOM
      els.phase1Body.appendChild(tr1);
      els.phase2Body.appendChild(tr2);

      // Initialize auto fields
      applyPhase2Autofields(wrapperSel.value, boxJ, boxK, boxL, boxO, boxS, boxT);
    }

    // -------------------------
    // EVENTS
    // -------------------------
    els.regionCode.addEventListener("change", refreshAllMarketDropdowns);
    els.addRowBtn.addEventListener("click", addRow);

    els.clearRowsBtn.addEventListener("click", () => {
      els.phase1Body.innerHTML = "";
      els.phase2Body.innerHTML = "";
      rowCounter = 1; // reset to mimic Excel starting at row 1
    });

    els.offerStart.addEventListener("input", refreshPhase2AutofieldsForAllRows);
    els.offerEnd.addEventListener("input", refreshPhase2AutofieldsForAllRows);

    // Start with one row like Excel
    addRow();
  </script>
</body>
</html>
