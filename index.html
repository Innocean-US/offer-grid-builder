<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Offer Grid Builder</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      max-width: 1100px;
      margin: 2rem auto;
      padding: 0 1rem;
      color: #111;
    }

    h1 { font-size: 1.6rem; margin-bottom: 0.25rem; }
    .hint { color:#666; font-size:0.9rem; margin-bottom: 1rem; }

    .card {
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 1rem;
      margin: 1rem 0;
      background: #fafafa;
    }

    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      align-items: end;
    }

    .field {
      display:flex;
      flex-direction:column;
      min-width: 220px;
    }

    label { font-weight: 650; margin-bottom: 0.25rem; }

    select, input {
      padding: 0.45rem 0.55rem;
      border: 1px solid #bbb;
      border-radius: 8px;
      background: white;
      font: inherit;
    }

    .small { font-size: 0.85rem; color:#666; margin-top:0.4rem; }

    .section-title {
      font-weight: 800;
      margin: 0 0 0.5rem 0;
    }

    .btns {
      display:flex;
      gap: 0.5rem;
      margin-top: 0.75rem;
      flex-wrap: wrap;
    }

    button {
      padding: 0.5rem 0.75rem;
      border-radius: 10px;
      border: 1px solid #bbb;
      background: white;
      cursor: pointer;
      font-weight: 650;
    }
    button:hover { background:#f3f3f3; }

    /* Tables */
    .table-wrap {
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 10px;
      overflow: auto;              /* horizontal scroll stays inside the box */
      max-width: 100%;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      min-width: 980px;            /* keeps columns readable; scroll stays in wrap */
    }

    th, td {
      border-bottom: 1px solid #eee;
      padding: 0.55rem;
      vertical-align: top;
      white-space: nowrap;
    }

    th {
      position: sticky;
      top: 0;
      background: #f2f2f2;
      text-align: left;
      font-weight: 800;
      border-bottom: 1px solid #ddd;
      z-index: 2;
    }

    td .cell {
      width: 100%;
    }

    .readonly {
      padding: 0.45rem 0.55rem;
      border: 1px solid #bbb;
      border-radius: 8px;
      background: #fff;
      min-height: 1.15rem;
      display: flex;
      align-items: center;
    }

    .readonly.blue {
      background: #d9f0f7;
      font-weight: 650;
    }

    /* Make the first column sticky for better Excel feel */
    .sticky-col {
      position: sticky;
      left: 0;
      background: #fff;
      z-index: 1;
      border-right: 1px solid #eee;
    }
    th.sticky-col {
      z-index: 3;
      background: #f2f2f2;
      border-right: 1px solid #ddd;
    }

    /* Smaller screens: reduce min width */
    @media (max-width: 720px) {
      table { min-width: 860px; }
    }
  </style>
</head>

<body>
  <h1>Offer Grid Builder</h1>
  <div class="hint">
    Excel-style horizontal rows. Phase 1 table on top, Phase 2 table directly below.
    Add/remove rows applies to both tables.
  </div>

  <!-- TOP CONTROLS -->
  <div class="card">
    <div class="row">
      <div class="field">
        <label for="regionCode">Region</label>
        <select id="regionCode">
          <option value="">-- Select Region --</option>
          <option value="ALR">ALR</option>
          <option value="CEN">CEN</option>
          <option value="EAS">EAS</option>
          <option value="MAT">MAT</option>
          <option value="MTN">MTN</option>
          <option value="SCR">SCR</option>
          <option value="SOU">SOU</option>
          <option value="WES">WES</option>
        </select>
        <div class="small">Updates all HDAA_Description dropdowns.</div>
      </div>

      <div class="field">
        <label for="offerStart">Offer Start Date</label>
        <input id="offerStart" type="date" />
      </div>

      <div class="field">
        <label for="offerEnd">Offer End Date</label>
        <input id="offerEnd" type="date" />
      </div>
    </div>
  </div>

  <!-- TABLES -->
  <div class="card">
    <div class="section-title">Phase 1: Offer Grid Rows</div>
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th class="sticky-col" style="width:110px;">Row</th>
            <th style="width:260px;">HDAA_Description</th>
            <th style="width:140px;">Model_Year</th>
            <th style="width:220px;">Model_Name</th>
            <th style="width:220px;">Trim_Name</th>
            <th style="width:160px;">Model_ID</th>
            <th style="width:120px;">Action</th>
          </tr>
        </thead>
        <tbody id="phase1Body"></tbody>
      </table>
    </div>

    <div style="height:16px;"></div>

    <div class="section-title">Phase 2: Cash Total Savings Offer Section</div>
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th class="sticky-col" style="width:110px;">Row</th>
            <th style="width:240px;">Creative_Name</th>
            <th style="width:240px;">Cash_Wrapper_Creative</th>
            <th style="width:220px;">Cash_Disclaimer_Type</th>
            <th style="width:220px;">Cash_Incentive_Number</th>

            <th style="width:220px;">Cash_Incentive_Type</th>
            <th style="width:240px;">Cash_Offer_DisplayName</th>
            <th style="width:180px;">Cash_Offer_Prefix</th>

            <th style="width:180px;">Cash_Offer_Price</th>
            <th style="width:220px;">Cash_Offer_Suffix</th>

            <th style="width:260px;">Cash_Offer_ShortDescription</th>

            <th style="width:300px;">Cash_RetailBonusCashOfferDetails</th>
            <th style="width:300px;">Cash_HmfStandardAprOfferDetails</th>
            <th style="width:260px;">Cash_Disclaimer</th>

            <th style="width:200px;">Cash_PurchaseStartDate</th>
            <th style="width:200px;">Cash_PurchaseEndDate</th>
          </tr>
        </thead>
        <tbody id="phase2Body"></tbody>
      </table>
    </div>

    <div class="btns">
      <button id="addRowBtn" type="button">Add Row</button>
      <button id="clearRowsBtn" type="button">Clear Rows</button>
    </div>

    <div class="small">
      Model_ID = lookup by Model_Name. Phase 2 auto fields populate when Cash_Wrapper_Creative is selected.
    </div>
  </div>

  <script>
    // -------------------------
    // LOOKUPS
    // -------------------------
    const MARKETS_BY_REGION = {
      ALR: ["All Markets","ALR"],
      CEN: ["All CEN","Chicago","CHI","Cincinnati","CIN","Cleveland","CLE","Columbus","COL","Detroit","DET","Indianapolis","IND","Milwaukee","MIL","St. Louis","STL"],
      EAS: ["All EAS","Albany-Schenectady","ALB","Bangor","PTB","Boston","BOS","Buffalo","BUF","Hartford","HAR","New York","NYC","Philadelphia","PHI","Portland-Polano","PTA","Providence-New Bedford","PRV","Rochester","ROH","Springfield","SCH"],
      MAT: ["All MAT","Baltimore","BAL","Charlotte","CHA","Greensboro","GHW","Norfolk/Portsmouth/Newport News","NOR","Raleigh-Durham","RAL","Richmond","RCH","Washington D.C.","WDC","Harrisburg-York","HRB","Pittsburgh","PIT","Wilkes Barre-Scranto","WIL"],
      MTN: ["All MTN","Boise","BOI","Colorado Springs","CSP","Denver","DEN","El Paso/Indianapolis St.","ELP","Minneapolis","MIN","Portland","POR","Salt Lake City","SLC","Seattle","SEA"],
      SCR: ["All SCR","Albuquerque","ABQ","Austin","AUS","Dallas","DAL","El Paso","ELP","Ft. Smith/Fayetteville/Springdale/Rogers","FSM","Houston","HOU","Kansas City","KAN","Little Rock","LRA","McAllen","MCA","Oklahoma City","OKC","San Antonio","SAN","Tulsa","TUL"],
      SOU: ["All SOU","Atlanta","ATL","Birmingham","BIR","Boca","BOC","Ft. Myers/Naples","FTM","Greenville/Spartanburg/Asheville/Anderson","GNV","Jacksonville","JAC","Memphis","MEM","Miami","MIA","Mobile","MOB","Nashville","NAS","New Orleans","NOL","Orlando","ORL","Savannah","SAV","Tampa","TAM","West Palm Beach-Ft. Pierce","WPB"],
      WES: ["All WES","Honolulu","HON","Las Vegas","LVG","Los Angeles","LOS","Phoenix","PHO","Sacramento","SAC","San Diego","SDO","Tucson","TUC","San Francisco","SFO"]
    };

    const MODEL_ID_BY_NAME = {
      "Alt Fuel": "",
      "Accent": "1001",
      "Elantra": "4001",
      "Elantra GT": "D001",
      "Elantra Hybrid": "4006",
      "Elantra N": "4008",
      "Ioniq 5": "5004",
      "Ioniq 6": "A004",
      "Ioniq 9": "7004",
      "Ioniq Hybrid": "N006",
      "Ioniq Plug-In Hybrid": "N005",
      "Kona": "Q001",
      "Kona Electric": "Q004",
      "Kona N": "Q008",
      "Nexo": "K007",
      "Palisade": "J001",
      "Palisade Hybrid": "J006",
      "Santa Cruz": "9001",
      "Santa Fe": "6001",
      "Santa Fe Hybrid": "6006",
      "Santa Fe Plug-In Hybrid": "6005",
      "Sonata": "2001",
      "Sonata Hybrid": "2006",
      "Tucson": "8001",
      "Tucson Hybrid": "8006",
      "Tucson Plug-In Hybrid": "8005",
      "Veloster": "F001",
      "Veloster N": "F008",
      "Venue": "3001"
    };

    const TRIMS = [
      "All","Blue","Blue Hybrid","Blue Hybrid AWD","Calligraphy","Calligraphy AWD","Electric Limited","Electric SE","Electric SEL","Hybrid Blue","Hybrid Limited","Hybrid SE","Hybrid SEL","Limited","Limited AWD","Limited Hybrid","Limited Hybrid AWD","Limited Plug-in Hybrid AWD",
      "N DCT","N Line","N Line AWD","N Line DCT","N Line FWD","N Line M/T","N Line Night Edition","N M/T","Night","Plug-in Hybrid Limited","Plug-in Hybrid SE","Plug-in Hybrid SEL","SE","SE AWD","SE Standard Range","SEL","SEL AWD","SEL Convenience Hybrid AWD","SEL Plug-in Hybrid AWD","SEL Plus","SEL Premium","XRT","XRT AWD","XRT FWD"
    ];

    const MODEL_YEARS = ["2025","2026","2027","2028","2029","2030"];

    const CREATIVE_NAME_OPTIONS = [
      { code: "",        label: "-- Select --" },
      { code: "25PROMO", label: "2025 Promo Period Creative" },
      { code: "SPGSE",   label: "Spring Getaway Sales Event" },
      { code: "SGSE",    label: "Summer Getaway Sales Event" },
      { code: "WGSE",    label: "Winter Getaway Sales Event" },
      { code: "WIN",     label: "Wins Every Time VS Campaign" },
      { code: "CUA",     label: "Customer Assurance" },
      { code: "BRD",     label: "Brand" },
      { code: "EVE",     label: "Evergreen" },
      { code: "EVECON",  label: "Evergreen Conquest" },
      { code: "EVERET",  label: "Evergreen Retention" }
    ];

    const CASH_WRAPPER_OPTIONS = [
      { label: "-- Select --" },
      { label: "Bonus Cash" },
      { label: "Dealer Cash" },
      { label: "Sales Event Cash" },
      { label: "Total Savings" },
      { label: "Total Savings + Charger + Installation" }
    ];

    // -------------------------
    // DOM
    // -------------------------
    const els = {
      regionCode: document.getElementById("regionCode"),
      offerStart: document.getElementById("offerStart"),
      offerEnd: document.getElementById("offerEnd"),
      phase1Body: document.getElementById("phase1Body"),
      phase2Body: document.getElementById("phase2Body"),
      addRowBtn: document.getElementById("addRowBtn"),
      clearRowsBtn: document.getElementById("clearRowsBtn")
    };

    // -------------------------
    // HELPERS
    // -------------------------
    function makeOption(value, textOverride = null) {
      const opt = document.createElement("option");
      opt.value = value;
      opt.textContent = (textOverride !== null) ? textOverride : value;
      return opt;
    }

    function makeOptionWithCode(label, code, valueOverride = null) {
      const opt = document.createElement("option");
      opt.value = (valueOverride !== null) ? valueOverride : label;
      opt.textContent = label;
      opt.dataset.code = code || "";
      return opt;
    }

    function buildMarketSelect(region) {
      const sel = document.createElement("select");
      sel.className = "cell hd-market";
      sel.appendChild(makeOption("", "-- Select --"));
      const list = region && MARKETS_BY_REGION[region] ? MARKETS_BY_REGION[region] : [];
      list.forEach(v => sel.appendChild(makeOption(v)));
      return sel;
    }

    function buildYearSelect() {
      const sel = document.createElement("select");
      sel.className = "cell hd-year";
      sel.appendChild(makeOption("", "-- Select --"));
      MODEL_YEARS.forEach(y => sel.appendChild(makeOption(y)));
      return sel;
    }

    function buildModelSelect() {
      const sel = document.createElement("select");
      sel.className = "cell hd-model";
      sel.appendChild(makeOption("", "-- Select --"));
      Object.keys(MODEL_ID_BY_NAME).forEach(name => sel.appendChild(makeOption(name)));
      return sel;
    }

    function buildTrimSelect() {
      const sel = document.createElement("select");
      sel.className = "cell hd-trim";
      sel.appendChild(makeOption("", "-- Select --"));
      TRIMS.forEach(t => sel.appendChild(makeOption(t)));
      return sel;
    }

    function buildCreativeNameSelect() {
      const sel = document.createElement("select");
      sel.className = "cell hd-creative-name";
      CREATIVE_NAME_OPTIONS.forEach((o, idx) => {
        const val = (idx === 0) ? "" : o.label;
        sel.appendChild(makeOptionWithCode(o.label, o.code, val));
      });
      return sel;
    }

    function buildCashWrapperSelect() {
      const sel = document.createElement("select");
      sel.className = "cell hd-cash-wrapper";
      CASH_WRAPPER_OPTIONS.forEach((o, idx) => {
        const opt = document.createElement("option");
        opt.value = (idx === 0) ? "" : o.label;
        opt.textContent = o.label;
        sel.appendChild(opt);
      });
      return sel;
    }

    function buildTextInput(className = "") {
      const input = document.createElement("input");
      input.type = "text";
      input.className = "cell " + className;
      return input;
    }

    function readonlyBlue(initialText = "", dataCol = "") {
      const box = document.createElement("div");
      box.className = "readonly blue";
      box.textContent = initialText;
      if (dataCol) box.setAttribute("data-col", dataCol);
      return box;
    }

    function computeModelId(modelName) {
      if (!modelName) return "";
      return MODEL_ID_BY_NAME[modelName] ?? "";
    }

    function formatDateShortMMDDYY(dateStr) {
      if (!dateStr) return "";
      const d = new Date(dateStr + "T00:00:00");
      if (isNaN(d.getTime())) return "";
      const mm = String(d.getMonth() + 1);
      const dd = String(d.getDate());
      const yy = String(d.getFullYear()).slice(-2);
      return `${mm}/${dd}/${yy}`;
    }

    function applyPhase2Autofields(wrapperValue, boxJ, boxK, boxL, boxO, boxS, boxT) {
      const hasWrapper = !!(wrapperValue && wrapperValue.trim());

      boxJ.textContent = hasWrapper ? wrapperValue : "";
      boxK.textContent = hasWrapper ? wrapperValue : "";
      boxL.textContent = hasWrapper ? "Up to" : "";
      boxO.textContent = hasWrapper ? wrapperValue : "";

      const start = els.offerStart.value || "";
      boxS.textContent = hasWrapper ? formatDateShortMMDDYY(start) : "";

      const end = els.offerEnd.value || "";
      boxT.textContent = hasWrapper ? formatDateShortMMDDYY(end) : "";
    }

    function refreshPhase2AutofieldsForAllRows() {
      els.phase2Body.querySelectorAll("tr[data-row-id]").forEach(tr => {
        const wrapperSel = tr.querySelector("select.hd-cash-wrapper");
        const boxJ = tr.querySelector("[data-col='J']");
        const boxK = tr.querySelector("[data-col='K']");
        const boxL = tr.querySelector("[data-col='L']");
        const boxO = tr.querySelector("[data-col='O']");
        const boxS = tr.querySelector("[data-col='S']");
        const boxT = tr.querySelector("[data-col='T']");
        if (!wrapperSel || !boxJ || !boxK || !boxL || !boxO || !boxS || !boxT) return;

        applyPhase2Autofields(wrapperSel.value, boxJ, boxK, boxL, boxO, boxS, boxT);
      });
    }

    function refreshAllMarketDropdowns() {
      const region = els.regionCode.value;
      const list = region && MARKETS_BY_REGION[region] ? MARKETS_BY_REGION[region] : [];

      els.phase1Body.querySelectorAll("select.hd-market").forEach(sel => {
        const current = sel.value;
        sel.innerHTML = "";
        sel.appendChild(makeOption("", "-- Select --"));
        list.forEach(v => sel.appendChild(makeOption(v)));
        sel.value = (current && list.includes(current)) ? current : "";
      });
    }

    // -------------------------
    // ROW MANAGEMENT (TWO TABLES)
    // -------------------------
    let rowCounter = 1;

    function removeRow(rowId) {
      els.phase1Body.querySelector(`tr[data-row-id="${rowId}"]`)?.remove();
      els.phase2Body.querySelector(`tr[data-row-id="${rowId}"]`)?.remove();
    }

    function addRow() {
      const rowId = String(rowCounter);
      rowCounter += 1;

      // ---------
      // Phase 1 row
      // ---------
      const tr1 = document.createElement("tr");
      tr1.setAttribute("data-row-id", rowId);

      const tdRow1 = document.createElement("td");
      tdRow1.className = "sticky-col";
      tdRow1.textContent = rowId;

      const tdMarket = document.createElement("td");
      const marketSel = buildMarketSelect(els.regionCode.value);
      tdMarket.appendChild(marketSel);

      const tdYear = document.createElement("td");
      const yearSel = buildYearSelect();
      tdYear.appendChild(yearSel);

      const tdModel = document.createElement("td");
      const modelSel = buildModelSelect();
      tdModel.appendChild(modelSel);

      const tdTrim = document.createElement("td");
      const trimSel = buildTrimSelect();
      tdTrim.appendChild(trimSel);

      const tdModelId = document.createElement("td");
      const modelIdBox = readonlyBlue("", "E");
      tdModelId.appendChild(modelIdBox);

      modelSel.addEventListener("change", () => {
        modelIdBox.textContent = computeModelId(modelSel.value);
      });

      const tdAction = document.createElement("td");
      const rmBtn = document.createElement("button");
      rmBtn.type = "button";
      rmBtn.textContent = "Remove";
      rmBtn.addEventListener("click", () => removeRow(rowId));
      tdAction.appendChild(rmBtn);

      tr1.appendChild(tdRow1);
      tr1.appendChild(tdMarket);
      tr1.appendChild(tdYear);
      tr1.appendChild(tdModel);
      tr1.appendChild(tdTrim);
      tr1.appendChild(tdModelId);
      tr1.appendChild(tdAction);

      // ---------
      // Phase 2 row
      // ---------
      const tr2 = document.createElement("tr");
      tr2.setAttribute("data-row-id", rowId);

      const tdRow2 = document.createElement("td");
      tdRow2.className = "sticky-col";
      tdRow2.textContent = rowId;

      const tdCreative = document.createElement("td");
      const creativeSel = buildCreativeNameSelect();
      tdCreative.appendChild(creativeSel);

      const tdWrapper = document.createElement("td");
      const wrapperSel = buildCashWrapperSelect();
      tdWrapper.appendChild(wrapperSel);

      const tdDisclaimerType = document.createElement("td");
      tdDisclaimerType.appendChild(buildTextInput("hd-cash-disclaimer-type"));

      const tdIncentiveNum = document.createElement("td");
      tdIncentiveNum.appendChild(buildTextInput("hd-cash-incentive-number"));

      const tdJ = document.createElement("td");
      const boxJ = readonlyBlue("", "J");
      tdJ.appendChild(boxJ);

      const tdK = document.createElement("td");
      const boxK = readonlyBlue("", "K");
      tdK.appendChild(boxK);

      const tdL = document.createElement("td");
      const boxL = readonlyBlue("", "L");
      tdL.appendChild(boxL);

      const tdPrice = document.createElement("td");
      tdPrice.appendChild(buildTextInput("hd-cash-offer-price"));

      const tdSuffix = document.createElement("td");
      tdSuffix.appendChild(buildTextInput("hd-cash-offer-suffix"));

      const tdO = document.createElement("td");
      const boxO = readonlyBlue("", "O");
      tdO.appendChild(boxO);

      const tdRetailBC = document.createElement("td");
      tdRetailBC.appendChild(buildTextInput("hd-cash-retail-bc-details"));

      const tdHmfApr = document.createElement("td");
      tdHmfApr.appendChild(buildTextInput("hd-cash-hmf-apr-details"));

      const tdDisclaimer = document.createElement("td");
      tdDisclaimer.appendChild(buildTextInput("hd-cash-disclaimer"));

      const tdS = document.createElement("td");
      const boxS = readonlyBlue("", "S");
      tdS.appendChild(boxS);

      const tdT = document.createElement("td");
      const boxT = readonlyBlue("", "T");
      tdT.appendChild(boxT);

      wrapperSel.addEventListener("change", () => {
        applyPhase2Autofields(wrapperSel.value, boxJ, boxK, boxL, boxO, boxS, boxT);
      });

      tr2.appendChild(tdRow2);
      tr2.appendChild(tdCreative);
      tr2.appendChild(tdWrapper);
      tr2.appendChild(tdDisclaimerType);
      tr2.appendChild(tdIncentiveNum);
      tr2.appendChild(tdJ);
      tr2.appendChild(tdK);
      tr2.appendChild(tdL);
      tr2.appendChild(tdPrice);
      tr2.appendChild(tdSuffix);
      tr2.appendChild(tdO);
      tr2.appendChild(tdRetailBC);
      tr2.appendChild(tdHmfApr);
      tr2.appendChild(tdDisclaimer);
      tr2.appendChild(tdS);
      tr2.appendChild(tdT);

      // Append both rows
      els.phase1Body.appendChild(tr1);
      els.phase2Body.appendChild(tr2);

      // Initialize auto fields (blank wrapper => blanks)
      applyPhase2Autofields(wrapperSel.value, boxJ, boxK, boxL, boxO, boxS, boxT);
    }

    // -------------------------
    // EVENTS
    // -------------------------
    els.regionCode.addEventListener("change", refreshAllMarketDropdowns);

    els.offerStart.addEventListener("input", refreshPhase2AutofieldsForAllRows);
    els.offerEnd.addEventListener("input", refreshPhase2AutofieldsForAllRows);

    els.addRowBtn.addEventListener("click", addRow);

    els.clearRowsBtn.addEventListener("click", () => {
      els.phase1Body.innerHTML = "";
      els.phase2Body.innerHTML = "";
      rowCounter = 1;
    });

    // Start with one row
    addRow();
  </script>
</body>
</html>
