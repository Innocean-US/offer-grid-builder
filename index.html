<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Offer Grid Builder</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      max-width: 1100px;
      margin: 2rem auto;
      padding: 0 1rem;
      color: #111;
    }

    h1 { font-size: 1.6rem; margin-bottom: 0.25rem; }
    .hint { color:#666; font-size:0.9rem; margin-bottom: 1rem; }

    .card {
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 1rem;
      margin: 1rem 0;
      background: #fafafa;
    }

    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      align-items: end;
    }

    .field {
      display:flex;
      flex-direction:column;
      min-width: 220px;
    }

    label { font-weight: 650; margin-bottom: 0.25rem; }

    select, input {
      padding: 0.45rem 0.55rem;
      border: 1px solid #bbb;
      border-radius: 8px;
      background: white;
      font: inherit;
    }

    button {
      padding: 0.5rem 0.75rem;
      border-radius: 10px;
      border: 1px solid #bbb;
      background: white;
      cursor: pointer;
      font-weight: 650;
    }

    button:hover { background:#f3f3f3; }

    .btns { display:flex; gap: 0.5rem; margin-top: 0.75rem; }
    .small { font-size: 0.85rem; color:#666; margin-top:0.4rem; }

    /* ---- Layout: stacked row cards + stacked phases ---- */

    #rowsContainer {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      margin-top: 0.75rem;
    }

    .row-card {
      border: 1px solid #ddd;
      border-radius: 12px;
      background: #fff;
      padding: 1rem;
    }

    .row-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 1rem;
      margin-bottom: 0.75rem;
    }

    .row-title { font-weight: 800; }

    .phase {
      border-top: 1px solid #eee;
      padding-top: 0.75rem;
      margin-top: 0.75rem;
    }

    .phase:first-of-type {
      border-top: 0;
      padding-top: 0;
      margin-top: 0;
    }

    .phase-title {
      font-weight: 800;
      margin-bottom: 0.5rem;
    }

    .phase-grid {
      display: grid;
      grid-template-columns: repeat(4, minmax(220px, 1fr));
      gap: 0.75rem 1rem;
    }

    @media (max-width: 1020px) {
      .phase-grid { grid-template-columns: repeat(2, minmax(220px, 1fr)); }
    }
    @media (max-width: 560px) {
      .phase-grid { grid-template-columns: 1fr; }
    }

    .field-wrap {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .field-label {
      font-weight: 650;
      font-size: 0.9rem;
      color: #111;
    }

    .readonly {
      padding: 0.45rem 0.55rem;
      border: 1px solid #bbb;
      border-radius: 8px;
      background: #fff;
      min-height: 1.15rem;
      display: flex;
      align-items: center;
    }

    .readonly.blue {
      background: #d9f0f7;
      font-weight: 650;
    }
  </style>
</head>

<body>
  <h1>Offer Grid Builder</h1>
  <div class="hint">
    Phase 1: Region + Offer Dates + row-entry grid with lookups (HDAA_Description / Model Year / Model Name / Trim) and auto-populated Model_ID.
    <br />
    Phase 2 sits directly below Phase 1 inside each row card. Future phases can stack below.
  </div>

  <!-- TOP CONTROLS -->
  <div class="card">
    <div class="row">
      <div class="field">
        <label for="regionCode">Region</label>
        <select id="regionCode">
          <option value="">-- Select Region --</option>
          <option value="ALR">ALR</option>
          <option value="CEN">CEN</option>
          <option value="EAS">EAS</option>
          <option value="MAT">MAT</option>
          <option value="MTN">MTN</option>
          <option value="SCR">SCR</option>
          <option value="SOU">SOU</option>
          <option value="WES">WES</option>
        </select>
        <div class="small">Updates all HDAA_Description dropdowns in existing rows.</div>
      </div>

      <div class="field">
        <label for="offerStart">Offer Start Date</label>
        <input id="offerStart" type="date" />
        <div class="small">Feeds Cash_PurchaseStartDate when wrapper is selected.</div>
      </div>

      <div class="field">
        <label for="offerEnd">Offer End Date</label>
        <input id="offerEnd" type="date" />
        <div class="small">Feeds Cash_PurchaseEndDate when wrapper is selected.</div>
      </div>
    </div>
  </div>

  <!-- ROWS -->
  <div class="card">
    <div style="font-weight:800; margin-bottom: 0.5rem;">Offer Grid Rows</div>

    <div id="rowsContainer"></div>

    <div class="btns">
      <button id="addRowBtn" type="button">Add Row</button>
      <button id="clearRowsBtn" type="button">Clear Rows</button>
    </div>

    <div class="small">
      Model_ID uses the same concept as your Excel formula:
      XLOOKUP(Model_Name, LookupTables[Model_Name], LookupTables[Model_ID]).
    </div>
  </div>

  <script>
    // =========================
    // LOOKUP DATA
    // =========================

    const MARKETS_BY_REGION = {
      ALR: ["All Markets","ALR"],
      CEN: ["All CEN","Chicago","CHI","Cincinnati","CIN","Cleveland","CLE","Columbus","COL","Detroit","DET","Indianapolis","IND","Milwaukee","MIL","St. Louis","STL"],
      EAS: ["All EAS","Albany-Schenectady","ALB","Bangor","PTB","Boston","BOS","Buffalo","BUF","Hartford","HAR","New York","NYC","Philadelphia","PHI","Portland-Polano","PTA","Providence-New Bedford","PRV","Rochester","ROH","Springfield","SCH"],
      MAT: ["All MAT","Baltimore","BAL","Charlotte","CHA","Greensboro","GHW","Norfolk/Portsmouth/Newport News","NOR","Raleigh-Durham","RAL","Richmond","RCH","Washington D.C.","WDC","Harrisburg-York","HRB","Pittsburgh","PIT","Wilkes Barre-Scranto","WIL"],
      MTN: ["All MTN","Boise","BOI","Colorado Springs","CSP","Denver","DEN","El Paso/Indianapolis St.","ELP","Minneapolis","MIN","Portland","POR","Salt Lake City","SLC","Seattle","SEA"],
      SCR: ["All SCR","Albuquerque","ABQ","Austin","AUS","Dallas","DAL","El Paso","ELP","Ft. Smith/Fayetteville/Springdale/Rogers","FSM","Houston","HOU","Kansas City","KAN","Little Rock","LRA","McAllen","MCA","Oklahoma City","OKC","San Antonio","SAN","Tulsa","TUL"],
      SOU: ["All SOU","Atlanta","ATL","Birmingham","BIR","Boca","BOC","Ft. Myers/Naples","FTM","Greenville/Spartanburg/Asheville/Anderson","GNV","Jacksonville","JAC","Memphis","MEM","Miami","MIA","Mobile","MOB","Nashville","NAS","New Orleans","NOL","Orlando","ORL","Savannah","SAV","Tampa","TAM","West Palm Beach-Ft. Pierce","WPB"],
      WES: ["All WES","Honolulu","HON","Las Vegas","LVG","Los Angeles","LOS","Phoenix","PHO","Sacramento","SAC","San Diego","SDO","Tucson","TUC","San Francisco","SFO"]
    };

    const MODEL_ID_BY_NAME = {
      "Alt Fuel": "",
      "Accent": "1001",
      "Elantra": "4001",
      "Elantra GT": "D001",
      "Elantra Hybrid": "4006",
      "Elantra N": "4008",
      "Ioniq 5": "5004",
      "Ioniq 6": "A004",
      "Ioniq 9": "7004",
      "Ioniq Hybrid": "N006",
      "Ioniq Plug-In Hybrid": "N005",
      "Kona": "Q001",
      "Kona Electric": "Q004",
      "Kona N": "Q008",
      "Nexo": "K007",
      "Palisade": "J001",
      "Palisade Hybrid": "J006",
      "Santa Cruz": "9001",
      "Santa Fe": "6001",
      "Santa Fe Hybrid": "6006",
      "Santa Fe Plug-In Hybrid": "6005",
      "Sonata": "2001",
      "Sonata Hybrid": "2006",
      "Tucson": "8001",
      "Tucson Hybrid": "8006",
      "Tucson Plug-In Hybrid": "8005",
      "Veloster": "F001",
      "Veloster N": "F008",
      "Venue": "3001"
    };

    const TRIMS = [
      "All","Blue","Blue Hybrid","Blue Hybrid AWD","Calligraphy","Calligraphy AWD","Electric Limited","Electric SE","Electric SEL","Hybrid Blue","Hybrid Limited","Hybrid SE","Hybrid SEL","Limited","Limited AWD","Limited Hybrid","Limited Hybrid AWD","Limited Plug-in Hybrid AWD",
      "N DCT","N Line","N Line AWD","N Line DCT","N Line FWD","N Line M/T","N Line Night Edition","N M/T","Night","Plug-in Hybrid Limited","Plug-in Hybrid SE","Plug-in Hybrid SEL","SE","SE AWD","SE Standard Range","SEL","SEL AWD","SEL Convenience Hybrid AWD","SEL Plug-in Hybrid AWD","SEL Plus","SEL Premium","XRT","XRT AWD","XRT FWD"
    ];

    const MODEL_YEARS = ["2025","2026","2027","2028","2029","2030"];

    const CREATIVE_NAME_OPTIONS = [
      { code: "",        label: "-- Select --" },
      { code: "25PROMO", label: "Promo Period Creative" },
      { code: "SPGSE",   label: "Spring Getaway Sales Event" },
      { code: "SGSE",    label: "Summer Getaway Sales Event" },
      { code: "WGSE",    label: "Winter Getaway Sales Event" },
      { code: "WIN",     label: "Wins Every Time VS Campaign" },
      { code: "CUA",     label: "Customer Assurance" },
      { code: "BRD",     label: "Brand" },
      { code: "EVE",     label: "Evergreen" },
      { code: "EVECON",  label: "Evergreen Conquest" },
      { code: "EVERET",  label: "Evergreen Retention" }
    ];

    const CASH_WRAPPER_OPTIONS = [
      { label: "-- Select --" },
      { label: "Bonus Cash" },
      { label: "Dealer Cash" },
      { label: "Sales Event Cash" },
      { label: "Total Savings" },
      { label: "Total Savings + Charger + Installation" }
    ];

    // =========================
    // DOM REFS
    // =========================

    const els = {
      regionCode: document.getElementById("regionCode"),
      offerStart: document.getElementById("offerStart"),
      offerEnd: document.getElementById("offerEnd"),
      rowsContainer: document.getElementById("rowsContainer"),
      addRowBtn: document.getElementById("addRowBtn"),
      clearRowsBtn: document.getElementById("clearRowsBtn")
    };

    // =========================
    // HELPERS
    // =========================

    function makeOption(value, textOverride = null) {
      const opt = document.createElement("option");
      opt.value = value;
      opt.textContent = textOverride !== null ? textOverride : value;
      return opt;
    }

    function makeOptionWithCode(label, code, valueOverride = null) {
      const opt = document.createElement("option");
      opt.value = valueOverride !== null ? valueOverride : label;
      opt.textContent = label;
      opt.dataset.code = code || "";
      return opt;
    }

    function fieldWrap(labelText, controlEl) {
      const wrap = document.createElement("div");
      wrap.className = "field-wrap";

      const lab = document.createElement("div");
      lab.className = "field-label";
      lab.textContent = labelText;

      wrap.appendChild(lab);
      wrap.appendChild(controlEl);
      return wrap;
    }

    function readonlyBlue(initialText = "", dataCol = "") {
      const box = document.createElement("div");
      box.className = "readonly blue";
      box.textContent = initialText;
      if (dataCol) box.setAttribute("data-col", dataCol);
      return box;
    }

    function buildTextInput(className = "") {
      const input = document.createElement("input");
      input.type = "text";
      if (className) input.className = className;
      return input;
    }

    function buildMarketSelect(region) {
      const sel = document.createElement("select");
      sel.className = "hd-market";

      sel.appendChild(makeOption("", "-- Select --"));
      const list = region && MARKETS_BY_REGION[region] ? MARKETS_BY_REGION[region] : [];
      list.forEach(v => sel.appendChild(makeOption(v)));
      return sel;
    }

    function buildYearSelect() {
      const sel = document.createElement("select");
      sel.className = "hd-year";
      sel.appendChild(makeOption("", "-- Select --"));
      MODEL_YEARS.forEach(y => sel.appendChild(makeOption(y)));
      return sel;
    }

    function buildModelSelect() {
      const sel = document.createElement("select");
      sel.className = "hd-model";
      sel.appendChild(makeOption("", "-- Select --"));
      Object.keys(MODEL_ID_BY_NAME).forEach(name => sel.appendChild(makeOption(name)));
      return sel;
    }

    function buildTrimSelect() {
      const sel = document.createElement("select");
      sel.className = "hd-trim";
      sel.appendChild(makeOption("", "-- Select --"));
      TRIMS.forEach(t => sel.appendChild(makeOption(t)));
      return sel;
    }

    function buildCreativeNameSelect() {
      const sel = document.createElement("select");
      sel.className = "hd-creative-name";

      CREATIVE_NAME_OPTIONS.forEach((o, idx) => {
        const val = idx === 0 ? "" : o.label;
        sel.appendChild(makeOptionWithCode(o.label, o.code, val));
      });

      return sel;
    }

    function buildCashWrapperSelect() {
      const sel = document.createElement("select");
      sel.className = "hd-cash-wrapper";

      CASH_WRAPPER_OPTIONS.forEach((o, idx) => {
        const opt = document.createElement("option");
        opt.value = idx === 0 ? "" : o.label;
        opt.textContent = o.label;
        sel.appendChild(opt);
      });

      return sel;
    }

    function computeModelId(modelName) {
      if (!modelName) return "";
      return MODEL_ID_BY_NAME[modelName] ?? "";
    }

    function formatDateShortMMDDYY(dateStr) {
      if (!dateStr) return "";
      const d = new Date(dateStr + "T00:00:00");
      if (isNaN(d.getTime())) return "";
      const mm = String(d.getMonth() + 1);
      const dd = String(d.getDate());
      const yy = String(d.getFullYear()).slice(-2);
      return `${mm}/${dd}/${yy}`;
    }

    function applyPhase2Autofields(wrapperValue, boxJ, boxK, boxL, boxO, boxS, boxT) {
      const hasWrapper = !!(wrapperValue && wrapperValue.trim());

      boxJ.textContent = hasWrapper ? wrapperValue : "";
      boxK.textContent = hasWrapper ? wrapperValue : "";
      boxL.textContent = hasWrapper ? "Up to" : "";
      boxO.textContent = hasWrapper ? wrapperValue : "";

      const start = els.offerStart.value || "";
      boxS.textContent = hasWrapper ? formatDateShortMMDDYY(start) : "";

      const end = els.offerEnd.value || "";
      boxT.textContent = hasWrapper ? formatDateShortMMDDYY(end) : "";
    }

    function refreshPhase2AutofieldsForAllRows() {
      document.querySelectorAll("div.row-card[data-offer-row='1']").forEach(card => {
        const wrapperSel = card.querySelector("select.hd-cash-wrapper");
        const boxJ = card.querySelector("[data-col='J']");
        const boxK = card.querySelector("[data-col='K']");
        const boxL = card.querySelector("[data-col='L']");
        const boxO = card.querySelector("[data-col='O']");
        const boxS = card.querySelector("[data-col='S']");
        const boxT = card.querySelector("[data-col='T']");
        if (!wrapperSel || !boxJ || !boxK || !boxL || !boxO || !boxS || !boxT) return;

        applyPhase2Autofields(wrapperSel.value, boxJ, boxK, boxL, boxO, boxS, boxT);
      });
    }

    function refreshAllMarketDropdowns() {
      const region = els.regionCode.value;

      document.querySelectorAll("select.hd-market").forEach(sel => {
        const current = sel.value;

        sel.innerHTML = "";
        sel.appendChild(makeOption("", "-- Select --"));

        const list = region && MARKETS_BY_REGION[region] ? MARKETS_BY_REGION[region] : [];
        list.forEach(v => sel.appendChild(makeOption(v)));

        sel.value = (current && list.includes(current)) ? current : "";
      });
    }

    // =========================
    // ROW BUILDER (CARDS)
    // =========================

    let rowCounter = 1;

    function addRow() {
      const card = document.createElement("div");
      card.className = "row-card";
      card.setAttribute("data-offer-row", "1");
      card.dataset.rowId = String(rowCounter++);

      // Header
      const header = document.createElement("div");
      header.className = "row-card-header";

      const title = document.createElement("div");
      title.className = "row-title";
      title.textContent = `Offer Row ${card.dataset.rowId}`;

      const removeBtn = document.createElement("button");
      removeBtn.type = "button";
      removeBtn.textContent = "Remove Row";
      removeBtn.addEventListener("click", () => card.remove());

      header.appendChild(title);
      header.appendChild(removeBtn);

      // --------------------
      // Phase 1
      // --------------------
      const phase1 = document.createElement("div");
      phase1.className = "phase";

      const p1Title = document.createElement("div");
      p1Title.className = "phase-title";
      p1Title.textContent = "Offer Grid Row";

      const p1Grid = document.createElement("div");
      p1Grid.className = "phase-grid";

      const marketSel = buildMarketSelect(els.regionCode.value);
      const yearSel = buildYearSelect();
      const modelSel = buildModelSelect();
      const trimSel = buildTrimSelect();

      const modelIdBox = readonlyBlue("", "E"); // not used in Phase2 calc, but fine
      modelSel.addEventListener("change", () => {
        modelIdBox.textContent = computeModelId(modelSel.value);
      });

      p1Grid.appendChild(fieldWrap("HDAA_Description", marketSel));
      p1Grid.appendChild(fieldWrap("Model_Year", yearSel));
      p1Grid.appendChild(fieldWrap("Model_Name", modelSel));
      p1Grid.appendChild(fieldWrap("Trim_Name", trimSel));
      p1Grid.appendChild(fieldWrap("Model_ID", modelIdBox));

      phase1.appendChild(p1Title);
      phase1.appendChild(p1Grid);

      // --------------------
      // Phase 2
      // --------------------
      const phase2 = document.createElement("div");
      phase2.className = "phase";

      const p2Title = document.createElement("div");
      p2Title.className = "phase-title";
      p2Title.textContent = "Cash Total Savings Offer Section";

      const p2Grid = document.createElement("div");
      p2Grid.className = "phase-grid";

      const creativeSel = buildCreativeNameSelect();
      card.dataset.creativeCode = creativeSel.selectedOptions?.[0]?.dataset?.code || "";
      creativeSel.addEventListener("change", () => {
        card.dataset.creativeCode = creativeSel.selectedOptions?.[0]?.dataset?.code || "";
      });

      const wrapperSel = buildCashWrapperSelect();

      const inDisclaimerType = buildTextInput("hd-cash-disclaimer-type");
      const inIncentiveNumber = buildTextInput("hd-cash-incentive-number");
      const inOfferPrice = buildTextInput("hd-cash-offer-price");
      const inOfferSuffix = buildTextInput("hd-cash-offer-suffix");
      const inRetailBCDetails = buildTextInput("hd-cash-retail-bc-details");
      const inHmfAprDetails = buildTextInput("hd-cash-hmf-apr-details");
      const inDisclaimer = buildTextInput("hd-cash-disclaimer");

      const boxJ = readonlyBlue("", "J");
      const boxK = readonlyBlue("", "K");
      const boxL = readonlyBlue("", "L");
      const boxO = readonlyBlue("", "O");
      const boxS = readonlyBlue("", "S");
      const boxT = readonlyBlue("", "T");

      // Key behavior: when wrapper changes, pull current Start/End dates
      wrapperSel.addEventListener("change", () => {
        applyPhase2Autofields(wrapperSel.value, boxJ, boxK, boxL, boxO, boxS, boxT);
      });

      p2Grid.appendChild(fieldWrap("Creative_Name", creativeSel));
      p2Grid.appendChild(fieldWrap("Cash_Wrapper_Creative", wrapperSel));
      p2Grid.appendChild(fieldWrap("Cash_Disclaimer_Type", inDisclaimerType));
      p2Grid.appendChild(fieldWrap("Cash_Incentive_Number", inIncentiveNumber));

      p2Grid.appendChild(fieldWrap("Cash_Incentive_Type", boxJ));
      p2Grid.appendChild(fieldWrap("Cash_Offer_DisplayName", boxK));
      p2Grid.appendChild(fieldWrap("Cash_Offer_Prefix ", boxL));

      p2Grid.appendChild(fieldWrap("Cash_Offer_Price", inOfferPrice));
      p2Grid.appendChild(fieldWrap("Cash_Offer_Suffix", inOfferSuffix));
      p2Grid.appendChild(fieldWrap("Cash_Offer_ShortDescription", boxO));

      p2Grid.appendChild(fieldWrap("Cash_RetailBonusCashOfferDetails", inRetailBCDetails));
      p2Grid.appendChild(fieldWrap("Cash_HmfStandardAprOfferDetails", inHmfAprDetails));
      p2Grid.appendChild(fieldWrap("Cash_Disclaimer", inDisclaimer));

      p2Grid.appendChild(fieldWrap("Cash_PurchaseStartDate", boxS));
      p2Grid.appendChild(fieldWrap("Cash_PurchaseEndDate", boxT));

      phase2.appendChild(p2Title);
      phase2.appendChild(p2Grid);

      // Assemble
      card.appendChild(header);
      card.appendChild(phase1);
      card.appendChild(phase2);

      els.rowsContainer.appendChild(card);

      // Initialize Phase 2 autos (blank wrapper => blanks)
      applyPhase2Autofields(wrapperSel.value, boxJ, boxK, boxL, boxO, boxS, boxT);
    }

    // =========================
    // EVENTS
    // =========================

    els.regionCode.addEventListener("change", refreshAllMarketDropdowns);

    // Use "input" so it updates immediately in more browsers
    els.offerStart.addEventListener("input", refreshPhase2AutofieldsForAllRows);
    els.offerEnd.addEventListener("input", refreshPhase2AutofieldsForAllRows);

    els.addRowBtn.addEventListener("click", addRow);

    els.clearRowsBtn.addEventListener("click", () => {
      els.rowsContainer.innerHTML = "";
      rowCounter = 1;
    });

    // Start with one row
    addRow();
  </script>
</body>
</html>
